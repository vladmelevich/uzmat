{% load static %}
<!-- Ğ’Ñ‹Ğ¿Ğ°Ğ´Ğ°ÑÑ‰Ğ¸Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº ÑÑ‚Ñ€Ğ°Ğ½ -->
<div class="uz-nav-country-selector" data-nav-country-selector>
  <button type="button" class="uz-nav-country-btn" data-nav-country-toggle>
    <span class="uz-nav-country-flag">
      <img id="nav-country-flag" src="{% static 'uzmat/kazah.svg' %}" alt="KZ" class="uz-nav-country-flag-img" onerror="this.style.display='none'; if(this.nextElementSibling){this.nextElementSibling.style.display='block';}">
      <span class="uz-nav-country-flag-fallback" style="display:none;">ğŸ‡°ğŸ‡¿</span>
    </span>
    <span class="uz-nav-country-code">KZ</span>
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="6 9 12 15 18 9"></polyline>
    </svg>
  </button>
  <div class="uz-nav-country-dropdown" data-nav-country-dropdown>
    <button type="button" class="uz-nav-country-option active" data-nav-country="kz" data-currency="â‚¸ KZT" data-lang="kk" data-flag="{% static 'uzmat/kazah.svg' %}">
      <span class="uz-nav-country-flag">
        <img src="{% static 'uzmat/kazah.svg' %}" alt="KZ" class="uz-nav-country-flag-img" onerror="this.style.display='none'; if(this.nextElementSibling){this.nextElementSibling.style.display='block';}">
        <span class="uz-nav-country-flag-fallback" style="display:none;">ğŸ‡°ğŸ‡¿</span>
      </span>
      <div class="uz-nav-country-info">
        <span class="uz-nav-country-name">ĞšĞ°Ğ·Ğ°Ñ…ÑÑ‚Ğ°Ğ½</span>
        <span class="uz-nav-country-currency">â‚¸ KZT</span>
      </div>
    </button>
    <button type="button" class="uz-nav-country-option" data-nav-country="uz" data-currency="ÑÑƒĞ¼ UZS" data-lang="uz" data-flag="{% static 'uzmat/uzbek.svg' %}">
      <span class="uz-nav-country-flag">
        <img src="{% static 'uzmat/uzbek.svg' %}" alt="UZ" class="uz-nav-country-flag-img" onerror="this.style.display='none'; if(this.nextElementSibling){this.nextElementSibling.style.display='block';}">
        <span class="uz-nav-country-flag-fallback" style="display:none;">ğŸ‡ºğŸ‡¿</span>
      </span>
      <div class="uz-nav-country-info">
        <span class="uz-nav-country-name">Ğ£Ğ·Ğ±ĞµĞºĞ¸ÑÑ‚Ğ°Ğ½</span>
        <span class="uz-nav-country-currency">ÑÑƒĞ¼ UZS</span>
      </div>
    </button>
    <button type="button" class="uz-nav-country-option" data-nav-country="ru" data-currency="â‚½ RUB" data-lang="ru" data-flag="{% static 'uzmat/russia.svg' %}">
      <span class="uz-nav-country-flag">
        <img src="{% static 'uzmat/russia.svg' %}" alt="RU" class="uz-nav-country-flag-img" onerror="this.style.display='none'; if(this.nextElementSibling){this.nextElementSibling.style.display='block';}">
        <span class="uz-nav-country-flag-fallback" style="display:none;">ğŸ‡·ğŸ‡º</span>
      </span>
      <div class="uz-nav-country-info">
        <span class="uz-nav-country-name">Ğ Ğ¾ÑÑĞ¸Ñ</span>
        <span class="uz-nav-country-currency">â‚½ RUB</span>
      </div>
    </button>
  </div>
</div>

<script>
  // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ ÑĞµĞ»ĞµĞºÑ‚Ğ¾Ñ€Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ñ‹
  function initCountrySelector() {
    const selector = document.querySelector('[data-nav-country-selector]');
    if (!selector) return;

    const toggleBtn = selector.querySelector('[data-nav-country-toggle]');
    const dropdown = selector.querySelector('[data-nav-country-dropdown]');
    const options = selector.querySelectorAll('.uz-nav-country-option');
    const flagImg = selector.querySelector('#nav-country-flag');
    const codeSpan = toggleBtn ? toggleBtn.querySelector('.uz-nav-country-code') : null;

    function closeDropdown() {
      selector.removeAttribute('data-open');
    }

    function openDropdown() {
      selector.setAttribute('data-open', 'true');
    }

    // Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½ÑƒÑ ÑÑ‚Ñ€Ğ°Ğ½Ñƒ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ UI, Ğ±ĞµĞ· Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ ÑĞ·Ñ‹ĞºĞ°)
    function restoreSelectedCountry() {
      // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ country Ğ² URL
      const urlParams = new URLSearchParams(window.location.search);
      const urlCountry = urlParams.get('country');
      
      // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ ÑÑ‚Ñ€Ğ°Ğ½Ñƒ Ğ¸Ğ· URL Ğ¸Ğ»Ğ¸ Ğ¸Ğ· localStorage
      const savedCountry = urlCountry || localStorage.getItem('selected_country');
      
      if (savedCountry) {
        const savedOption = Array.from(options).find(opt => 
          opt.getAttribute('data-nav-country') === savedCountry
        );
        if (savedOption) {
          // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ UI
          options.forEach(o => o.classList.remove('active'));
          savedOption.classList.add('active');
          
          const flagSrc = savedOption.getAttribute('data-flag') || '';
          const code = savedOption.getAttribute('data-nav-country')?.toUpperCase() || '';
          
          if (flagImg && flagSrc) flagImg.src = flagSrc;
          if (codeSpan) codeSpan.textContent = code;
          
          // Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ¸Ğ· ÑÑ‚Ñ€Ğ°Ğ½Ñ‹, ĞµÑĞ»Ğ¸ Ğ¾Ğ½ Ğ½Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½
          const savedLang = localStorage.getItem('i18n_lang');
          if (!savedLang && window.i18n) {
            const lang = savedOption.getAttribute('data-lang') || 'ru';
            if (window.i18n.setLanguage) {
              // ĞĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ°Ñ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ°, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ i18n Ğ±Ñ‹Ğ» Ğ³Ğ¾Ñ‚Ğ¾Ğ²
              setTimeout(() => {
                window.i18n.setLanguage(lang);
              }, 100);
            }
          }
        }
      }
    }

    // Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½ÑƒÑ ÑÑ‚Ñ€Ğ°Ğ½Ñƒ ÑÑ€Ğ°Ğ·Ñƒ
    restoreSelectedCountry();

    if (toggleBtn) {
      toggleBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        if (selector.hasAttribute('data-open')) {
          closeDropdown();
        } else {
          openDropdown();
        }
      });
    }

    options.forEach(option => {
      option.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const country = option.getAttribute('data-nav-country') || '';
        const lang = option.getAttribute('data-lang') || 'ru';

        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ ÑĞºÑ€Ğ¾Ğ»Ğ»Ğ° Ğ¿ĞµÑ€ĞµĞ´ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸ĞµĞ¼
        const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;

        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½ÑƒÑ ÑÑ‚Ñ€Ğ°Ğ½Ñƒ Ğ¸ ÑĞ·Ñ‹Ğº
        localStorage.setItem('selected_country', country);
        localStorage.setItem('i18n_lang', lang);
        // Ğ¢Ğ°ĞºĞ¶Ğµ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ ĞºĞ°Ğº Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹ (ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğ°)
        localStorage.setItem('filter_country', country);

        // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ UI ÑĞµĞ»ĞµĞºÑ‚Ğ¾Ñ€Ğ°
        options.forEach(o => o.classList.remove('active'));
        option.classList.add('active');
        
        const flagSrc = option.getAttribute('data-flag') || '';
        const code = country.toUpperCase();
        
        if (flagImg && flagSrc) flagImg.src = flagSrc;
        if (codeSpan) codeSpan.textContent = code;

        // Ğ—Ğ°ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ²Ñ‹Ğ¿Ğ°Ğ´Ğ°ÑÑ‰Ğ¸Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº
        closeDropdown();

        // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ ÑĞ·Ñ‹Ğº Ğ² localStorage ÑÑ€Ğ°Ğ·Ñƒ
        localStorage.setItem('i18n_lang', lang);
        
        // Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ ÑĞ·Ñ‹Ğº Ñ‡ĞµÑ€ĞµĞ· i18n (ĞµÑĞ»Ğ¸ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½)
        if (window.i18n && window.i18n.setLanguage) {
          window.i18n.setLanguage(lang);
        }
        
        // ĞŸĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ ÑĞ·Ñ‹ĞºĞ°
        // Ğ­Ñ‚Ğ¾ Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚, Ñ‡Ñ‚Ğ¾ Ğ²ÑĞµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ±ÑƒĞ´ÑƒÑ‚ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°Ñ‚ÑŒÑÑ Ğ½Ğ° Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ
        window.location.reload();

        // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ URL Ğ±ĞµĞ· Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹
        const url = new URL(window.location.href);
        url.searchParams.set('country', country);
        window.history.replaceState({}, '', url.toString());

        // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹ Ğ½Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ (ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ¸ ĞµÑÑ‚ÑŒ)
        // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ½ĞµĞ±Ğ¾Ğ»ÑŒÑˆÑƒÑ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºÑƒ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑƒĞ±ĞµĞ´Ğ¸Ñ‚ÑŒÑÑ Ñ‡Ñ‚Ğ¾ DOM Ğ³Ğ¾Ñ‚Ğ¾Ğ²
        setTimeout(() => {
          updatePageFilters(country);
        }, 50);

        // Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ ÑĞºÑ€Ğ¾Ğ»Ğ»Ğ°
        window.scrollTo(0, scrollPosition);

        // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
        setTimeout(() => {
          if (window.showToast) {
            const countryNames = {
              'kz': 'ĞšĞ°Ğ·Ğ°Ñ…ÑÑ‚Ğ°Ğ½',
              'uz': 'Ğ£Ğ·Ğ±ĞµĞºĞ¸ÑÑ‚Ğ°Ğ½',
              'ru': 'Ğ Ğ¾ÑÑĞ¸Ñ',
            };
            window.showToast(`Ğ¡Ñ‚Ñ€Ğ°Ğ½Ğ° Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ° Ğ½Ğ° ${countryNames[country] || country}`, 'success');
          }
        }, 50);
      });
    });

    document.addEventListener('click', function(e) {
      if (!selector.contains(e.target)) {
        closeDropdown();
      }
    });
    
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') closeDropdown();
    });
  }

  // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ² Ğ½Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ Ğ¿Ñ€Ğ¸ ÑĞ¼ĞµĞ½Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹
  function updatePageFilters(country) {
    // Ğ˜Ñ‰ĞµĞ¼ Ñ„Ğ¾Ñ€Ğ¼Ñƒ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²
    const filterForm = document.getElementById('filters-form');
    if (!filterForm) return;

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑĞºÑ€Ñ‹Ñ‚Ğ¾Ğµ Ğ¿Ğ¾Ğ»Ğµ country Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğµ
    const countryInput = filterForm.querySelector('input[name="country"]');
    if (countryInput) {
      countryInput.value = country === 'all' ? '' : country;
    }

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ñ‹ Ğ² Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğµ
    const countrySelector = filterForm.querySelector('[data-filter-country]');
    if (countrySelector) {
      const countryDisplay = countrySelector.querySelector('[data-filter-country-display]');
      const countryOptions = countrySelector.querySelectorAll('[data-filter-name="country"]');
      
      // ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ğ¼ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½ÑƒÑ Ğ¾Ğ¿Ñ†Ğ¸Ñ
      const selectedOption = Array.from(countryOptions).find(opt => {
        const optValue = opt.getAttribute('data-filter-value');
        return optValue === country || (country === 'all' && optValue === 'all');
      });
      
      if (selectedOption && countryDisplay) {
        // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ
        countryDisplay.textContent = selectedOption.textContent.trim();
        
        // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ
        countryOptions.forEach(opt => opt.classList.remove('active'));
        selectedOption.classList.add('active');
      }
    }

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ¾Ğ² (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½ÑƒÑ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ)
    if (window.updateCityList && typeof window.updateCityList === 'function') {
      window.updateCityList(country);
    }

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ğ¾Ğ»Ñ Ñ†ĞµĞ½Ñ‹ (Ğ²ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼/Ğ²Ñ‹ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼) - Ğ’ĞĞ–ĞĞ: Ğ´ĞµĞ»Ğ°ĞµĞ¼ ÑÑ‚Ğ¾ ÑÑ€Ğ°Ğ·Ñƒ Ğ¸ Ğ¿Ñ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾
    const priceInputs = filterForm.querySelectorAll('input[name="price_from"], input[name="price_to"]');
    const hasCountry = country && country !== 'all' && country !== '';
    
    if (priceInputs.length > 0) {
      priceInputs.forEach(input => {
        if (hasCountry) {
          // Ğ•ÑĞ»Ğ¸ ÑÑ‚Ñ€Ğ°Ğ½Ğ° Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ° - Ğ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾Ğ»Ñ
          input.removeAttribute('disabled');
          input.disabled = false;
        } else {
          // Ğ•ÑĞ»Ğ¸ ÑÑ‚Ñ€Ğ°Ğ½Ğ° Ğ½Ğµ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ° - Ğ´ĞµĞ°ĞºÑ‚Ğ¸Ğ²Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ğ¾Ğ»Ñ
          input.setAttribute('disabled', 'disabled');
          input.disabled = true;
          input.value = '';
        }
      });
      
      // Ğ¢Ğ°ĞºĞ¶Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ disabled)
      const priceContainer = filterForm.querySelector('.uz-filter-price-range');
      if (priceContainer) {
        if (hasCountry) {
          priceContainer.classList.remove('disabled');
        } else {
          priceContainer.classList.add('disabled');
        }
      }
    } else {
      // Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»Ñ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ñ‹, Ğ¿Ñ€Ğ¾Ğ±ÑƒĞµĞ¼ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ¸Ñ… Ñ‡ĞµÑ€ĞµĞ· Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ ÑĞµĞ»ĞµĞºÑ‚Ğ¾Ñ€
      const priceFrom = filterForm.querySelector('input[name="price_from"]');
      const priceTo = filterForm.querySelector('input[name="price_to"]');
      if (priceFrom) {
        if (hasCountry) {
          priceFrom.removeAttribute('disabled');
          priceFrom.disabled = false;
        } else {
          priceFrom.setAttribute('disabled', 'disabled');
          priceFrom.disabled = true;
          priceFrom.value = '';
        }
      }
      if (priceTo) {
        if (hasCountry) {
          priceTo.removeAttribute('disabled');
          priceTo.disabled = false;
        } else {
          priceTo.setAttribute('disabled', 'disabled');
          priceTo.disabled = true;
          priceTo.value = '';
        }
      }
    }

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ñ‡ĞµÑ€ĞµĞ· AJAX (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½ÑƒÑ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ)
    if (window.submitFormAjax && typeof window.submitFormAjax === 'function') {
      // ĞĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ°Ñ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ°, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ´Ğ°Ñ‚ÑŒ Ğ²Ñ€ĞµĞ¼Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒÑÑ ÑĞ¿Ğ¸ÑĞºÑƒ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ¾Ğ²
      setTimeout(() => {
        window.submitFormAjax();
      }, 100);
    }
  }

  // Ğ¡Ğ»ÑƒÑˆĞ°Ñ‚ĞµĞ»ÑŒ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ÑĞ·Ñ‹ĞºĞ° Ğ´Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ²ÑĞµÑ… ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
  document.addEventListener('languageChanged', function(e) {
    const lang = e.detail.lang;
    // ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ğ²ÑĞµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ¿Ğ¾ÑĞ»Ğµ ÑĞ¼ĞµĞ½Ñ‹ ÑĞ·Ñ‹ĞºĞ°
    setTimeout(() => {
      if (window.i18n && window.i18n.translatePage) {
        window.i18n.translatePage(lang);
      }
    }, 50);
  });

  // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ DOM
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCountrySelector);
  } else {
    // DOM ÑƒĞ¶Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½
    initCountrySelector();
  }
</script>

{% load static %}
<!DOCTYPE html>
<html lang="ru" id="html-lang">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  {% include 'uzmat/seo_meta.html' with title="–ê—Ä–µ–Ω–¥–∞ –∏ –ø—Ä–æ–¥–∞–∂–∞ —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∏ –≤ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –ê–∑–∏–∏" description="Uzmat ‚Äî –µ–¥–∏–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–¥–µ–∂–Ω—ã—Ö –ø–æ–¥—Ä—è–¥—á–∏–∫–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä–∫–æ–º —Ç–µ—Ö–Ω–∏–∫–∏. –ê—Ä–µ–Ω–¥–∞ –∏ –ø—Ä–æ–¥–∞–∂–∞ —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∏: —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä—ã, –ø–æ–≥—Ä—É–∑—á–∏–∫–∏, –∫—Ä–∞–Ω—ã, –±—É–ª—å–¥–æ–∑–µ—Ä—ã, —Å–∞–º–æ—Å–≤–∞–ª—ã. –ó–∞–ø—á–∞—Å—Ç–∏ –∏ —É—Å–ª—É–≥–∏. –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω, –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω, –†–æ—Å—Å–∏—è." keywords="–∞—Ä–µ–Ω–¥–∞ —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∏, –ø—Ä–æ–¥–∞–∂–∞ —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∏, —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä, –ø–æ–≥—Ä—É–∑—á–∏–∫, –∫—Ä–∞–Ω, –±—É–ª—å–¥–æ–∑–µ—Ä, —Å–∞–º–æ—Å–≤–∞–ª, –∞—Ä–µ–Ω–¥–∞ —Ç–µ—Ö–Ω–∏–∫–∏ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω, –∞—Ä–µ–Ω–¥–∞ —Ç–µ—Ö–Ω–∏–∫–∏ –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω, –∑–∞–ø—á–∞—Å—Ç–∏ –¥–ª—è —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∏, —É—Å–ª—É–≥–∏ —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∏" %}
  <link rel="icon" type="image/svg+xml" href="{% static 'uzmat/logo-uzmat.svg' %}">
  {% include 'uzmat/theme-init.html' %}
  <link rel="stylesheet" href="{% static 'uzmat/styles.css' %}">
  <script defer src="{% static 'uzmat/app.js' %}"></script>
  
  <!-- Structured Data (Schema.org) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Uzmat",
    "description": "–ï–¥–∏–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–¥–µ–∂–Ω—ã—Ö –ø–æ–¥—Ä—è–¥—á–∏–∫–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä–∫–æ–º —Ç–µ—Ö–Ω–∏–∫–∏ –≤ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –ê–∑–∏–∏",
    "url": "{{ request.scheme }}://{{ request.get_host }}",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "{{ request.scheme }}://{{ request.get_host }}{% url 'uzmat:catalog' %}?search={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Uzmat",
    "url": "{{ request.scheme }}://{{ request.get_host }}",
    "logo": "{{ request.scheme }}://{{ request.get_host }}{% static 'uzmat/logo-uzmat.svg' %}",
    "description": "–ï–¥–∏–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∞—Ä–µ–Ω–¥—ã –∏ –ø—Ä–æ–¥–∞–∂–∏ —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∏ –≤ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –ê–∑–∏–∏",
    "contactPoint": {
      "@type": "ContactPoint",
      "telephone": "+998200059890",
      "contactType": "customer service",
      "areaServed": ["KZ", "UZ", "RU"],
      "availableLanguage": ["Russian"]
    },
    "address": {
      "@type": "PostalAddress",
      "addressRegion": "Andijan Region",
      "addressLocality": "Shkhrixan"
    }
  }
  </script>
</head>

<body class="uz-body">
  {% include 'uzmat/toast-container.html' %}

  <!-- Floating Header -->
  <header class="uz-header">
    <div class="uz-header-inner">
      <a href="{% url 'uzmat:index' %}" class="uz-logo">
        <img src="{% static 'uzmat/logo-uzmat.svg' %}" alt="Uzmat" class="uz-logo-mark">
        <span>Uzmat</span>
      </a>

      {% include 'uzmat/nav.html' %}

      <div class="uz-flex">
        {% include 'uzmat/country-selector.html' %}
        {% include 'uzmat/create-ad-button.html' %}
        <button class="uz-btn uz-btn-ghost uz-hidden-mobile" data-theme-toggle>
          <!-- Sun/Moon SVG will be handled by JS or default to SVG here -->
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
        </button>
        {% include 'uzmat/user-avatar.html' %}
      </div>
    </div>
  </header>

  <main class="uz-container">

    <!-- Hero Section -->
    <section class="uz-hero uz-animate-in">
      <h1 class="uz-hero-title">
        <span data-translate="–ê—Ä–µ–Ω–¥–∞ —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∏ –±–∏–∑–Ω–µ—Å-–∫–ª–∞—Å—Å–∞">–ê—Ä–µ–Ω–¥–∞ —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∏<br>–±–∏–∑–Ω–µ—Å-–∫–ª–∞—Å—Å–∞</span>
      </h1>
      <!-- SEO: –û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ -->
      <p class="uz-hero-subtitle">
        –ï–¥–∏–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –Ω–∞–¥–µ–∂–Ω—ã—Ö –ø–æ–¥—Ä—è–¥—á–∏–∫–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä–∫–æ–º —Ç–µ—Ö–Ω–∏–∫–∏. –ê—Ä–µ–Ω–¥–∞ –∏ –ø—Ä–æ–¥–∞–∂–∞ —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∏: —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä—ã, –ø–æ–≥—Ä—É–∑—á–∏–∫–∏, –∫—Ä–∞–Ω—ã, –±—É–ª—å–¥–æ–∑–µ—Ä—ã, —Å–∞–º–æ—Å–≤–∞–ª—ã –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ, –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–µ –∏ –†–æ—Å—Å–∏–∏.
      </p>

      <div class="uz-search-container">
        <input type="text" class="uz-search-input" id="hero-search-input" placeholder="–ù–∞–π—Ç–∏ —ç–∫—Å–∫–∞–≤–∞—Ç–æ—Ä, –∫—Ä–∞–Ω –∏–ª–∏ –ø–æ–≥—Ä—É–∑—á–∏–∫...">
        <svg class="uz-search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
      </div>

      <!-- –ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ –ø–æ–∏—Å–∫–∞ -->
      <div class="uz-search-quick-buttons">
        <span class="uz-search-quick-label">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:</span>
        <div class="uz-search-quick-list">
          <button type="button" class="uz-search-quick-btn" data-search-query="–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä">–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä</button>
          <button type="button" class="uz-search-quick-btn" data-search-query="–ü–æ–≥—Ä—É–∑—á–∏–∫">–ü–æ–≥—Ä—É–∑—á–∏–∫</button>
          <button type="button" class="uz-search-quick-btn" data-search-query="–ö—Ä–∞–Ω">–ö—Ä–∞–Ω</button>
          <button type="button" class="uz-search-quick-btn" data-search-query="–ë—É–ª—å–¥–æ–∑–µ—Ä">–ë—É–ª—å–¥–æ–∑–µ—Ä</button>
          <button type="button" class="uz-search-quick-btn" data-search-query="–°–∞–º–æ—Å–≤–∞–ª">–°–∞–º–æ—Å–≤–∞–ª</button>
          <button type="button" class="uz-search-quick-btn" data-search-query="–ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä">–ú–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä</button>
        </div>
      </div>
    </section>

    <!-- Banner Advertisement Section -->
    <section class="uz-banner-ad uz-animate-in" style="animation-delay: 0.12s; margin-top: 40px;">
      <div class="uz-banner-ad-container">
        <div class="uz-banner-ad-placeholder" id="banner-ad-placeholder">
          <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–∞–∑–º–µ—â–µ–Ω –±–∞–Ω–Ω–µ—Ä —Ä–µ–∫–ª–∞–º—ã -->
          <!-- –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–≥ <img> –∏–ª–∏ <iframe> –¥–ª—è —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –±–∞–Ω–Ω–µ—Ä–∞ -->
          <!-- –ü—Ä–∏–º–µ—Ä: <img src="/path/to/banner.jpg" alt="–†–µ–∫–ª–∞–º–∞" style="width: 100%; height: 100%; object-fit: cover;"> -->
        </div>
      </div>
    </section>

    <!-- Hot Offers Section -->
    <section class="uz-hot-offers uz-animate-in" style="animation-delay: 0.15s; margin-top: 40px;">
      <div class="uz-hot-offers-header">
        <h2 class="uz-hot-offers-title">
          –ì–æ—Ä—è—á–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
        </h2>
      </div>

      <div class="uz-hot-offers-grid-wrapper">
        <div class="uz-hot-offers-grid" id="hot-offers-grid">
          {% for ad in hot_offers %}
          {% if ad.slug %}
          <a href="{% url 'uzmat:ad_detail' slug=ad.slug %}" class="uz-hot-offer-item">
            <div class="uz-hot-offer-image">
              {% if ad.images.exists %}
                <img src="{{ ad.images.first.image.url }}" alt="{{ ad.title }}" style="width: 100%; height: 100%; object-fit: cover; object-position: center;">
              {% elif ad.image %}
                <img src="{{ ad.image.url }}" alt="{{ ad.title }}" style="width: 100%; height: 100%; object-fit: cover; object-position: center;">
              {% else %}
                <svg class="uz-hot-offer-icon" viewBox="0 0 775 775" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M209.896 678.125C290.15 678.125 355.208 613.066 355.208 532.812C355.208 452.559 290.15 387.5 209.896 387.5C129.642 387.5 64.5833 452.559 64.5833 532.812C64.5833 613.066 129.642 678.125 209.896 678.125Z" stroke="currentColor" stroke-width="48.4375" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M613.542 678.125C667.044 678.125 710.417 634.753 710.417 581.25C710.417 527.747 667.044 484.375 613.542 484.375C560.039 484.375 516.667 527.747 516.667 581.25C516.667 634.753 560.039 678.125 613.542 678.125Z" stroke="currentColor" stroke-width="48.4375" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M64.5833 339.059C101.195 311.596 144.839 295.068 190.459 291.392C236.079 287.716 281.807 297.042 322.344 318.288C362.881 339.535 396.568 371.834 419.501 411.441C442.434 451.048 453.675 496.343 451.922 542.077C451.179 561.581 450.824 571.366 455.571 576.306C460.318 581.247 469.133 581.247 486.732 581.247H516.667M419.792 290.622L520.089 309.416C595.652 323.624 633.466 330.696 655.779 357.595C678.125 384.494 678.125 423.147 678.125 500.518M645.833 387.497H613.542" stroke="currentColor" stroke-width="48.4375" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M419.792 403.646V309.58C419.792 296.943 417.973 284.565 414.334 272.445L371.354 96.875M129.167 290.625V96.875M96.875 96.875H419.792M581.25 306.771V258.333C581.25 241.205 588.054 224.778 600.166 212.666C612.278 200.554 628.705 193.75 645.833 193.75M226.042 290.625V96.875" stroke="currentColor" stroke-width="48.4375" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              {% endif %}
            </div>
            <div style="padding: 8px 10px 10px; font-size: 13px; font-weight: 600; color: var(--uz-text); line-height: 1.4;">
              {{ ad.title }}
            </div>
          </a>
          {% endif %}
          {% endfor %}
          {% if not hot_offers %}
          {% for i in "1234567"|make_list %}
          <a href="{% url 'uzmat:catalog' %}" class="uz-hot-offer-item">
            <div class="uz-hot-offer-image">
              <svg class="uz-hot-offer-icon" viewBox="0 0 775 775" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M209.896 678.125C290.15 678.125 355.208 613.066 355.208 532.812C355.208 452.559 290.15 387.5 209.896 387.5C129.642 387.5 64.5833 452.559 64.5833 532.812C64.5833 613.066 129.642 678.125 209.896 678.125Z" stroke="currentColor" stroke-width="48.4375" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M613.542 678.125C667.044 678.125 710.417 634.753 710.417 581.25C710.417 527.747 667.044 484.375 613.542 484.375C560.039 484.375 516.667 527.747 516.667 581.25C516.667 634.753 560.039 678.125 613.542 678.125Z" stroke="currentColor" stroke-width="48.4375" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M64.5833 339.059C101.195 311.596 144.839 295.068 190.459 291.392C236.079 287.716 281.807 297.042 322.344 318.288C362.881 339.535 396.568 371.834 419.501 411.441C442.434 451.048 453.675 496.343 451.922 542.077C451.179 561.581 450.824 571.366 455.571 576.306C460.318 581.247 469.133 581.247 486.732 581.247H516.667M419.792 290.622L520.089 309.416C595.652 323.624 633.466 330.696 655.779 357.595C678.125 384.494 678.125 423.147 678.125 500.518M645.833 387.497H613.542" stroke="currentColor" stroke-width="48.4375" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M419.792 403.646V309.58C419.792 296.943 417.973 284.565 414.334 272.445L371.354 96.875M129.167 290.625V96.875M96.875 96.875H419.792M581.25 306.771V258.333C581.25 241.205 588.054 224.778 600.166 212.666C612.278 200.554 628.705 193.75 645.833 193.75M226.042 290.625V96.875" stroke="currentColor" stroke-width="48.4375" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
          </a>
          {% endfor %}
          {% endif %}
        </div>

      </div>
    </section>

    <!-- Categories Section -->
    <section class="uz-categories uz-animate-in" style="animation-delay: 0.2s; margin-top: 60px;">
      <div class="uz-categories-grid">
        <!-- Category 1: –ü—Ä–æ–¥–∞–∂–∞ —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∏ -->
        <a href="{% url 'uzmat:catalog' %}?ad_type=sale" class="uz-category-card uz-category-card-large">
          <div class="uz-category-icon">
            <img src="{% static 'uzmat/telegram-cloud-document-2-5289604459586945170-removebg-preview.png' %}" alt="–≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä">
          </div>
          <span class="uz-category-text">–ü—Ä–æ–¥–∞–∂–∞ —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∏</span>
        </a>

        <!-- Category 2: –ê—Ä–µ–Ω–¥–∞ —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∏ -->
        <a href="{% url 'uzmat:catalog' %}?ad_type=rent" class="uz-category-card uz-category-card-large">
          <div class="uz-category-icon">
            <img src="{% static 'uzmat/telegram-cloud-document-2-5289604459586945172-removebg-preview.png' %}" alt="–ê—Ä–µ–Ω–¥–∞ —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∏">
          </div>
          <span class="uz-category-text">–ê—Ä–µ–Ω–¥–∞ —Å–ø–µ—Ü—Ç–µ—Ö–Ω–∏–∫–∏</span>
        </a>

        <!-- Category 3: –ó–∞—è–≤–∫–∏ -->
        <a href="{% url 'uzmat:chats' %}" class="uz-category-card uz-category-card-medium" style="position: relative;">
          <div class="uz-category-icon">
            <img src="{% static 'uzmat/telegram-cloud-document-2-5289604459586945282-removebg-preview.png' %}" alt="–ó–∞—è–≤–∫–∏">
          </div>
          <span class="uz-category-text">–ó–∞—è–≤–∫–∏</span>
          {% if user.is_authenticated and unread_messages_count > 0 %}
          <span class="uz-badge" style="position: absolute; top: 6px; right: 6px; background: var(--uz-danger); color: white; min-width: 18px; height: 18px; padding: 0 5px; font-size: 10px; font-weight: 700; border-radius: 9px; display: flex; align-items: center; justify-content: center;">{{ unread_messages_count }}</span>
          {% endif %}
        </a>

        <!-- Category 4: –ó–∞–ø—á–∞—Å—Ç–∏ -->
        <a href="{% url 'uzmat:parts_repair' %}" class="uz-category-card uz-category-card-small">
          <div class="uz-category-icon">
            <img src="{% static 'uzmat/telegram-cloud-document-2-5289604459586945174-removebg-preview.png' %}" alt="–ó–∞–ø—á–∞—Å—Ç–∏">
          </div>
          <span class="uz-category-text">–ó–∞–ø—á–∞—Å—Ç–∏</span>
        </a>

        <!-- Category 5: –†–µ–º–æ–Ω—Ç (—É—Å–ª—É–≥–∏) -->
        <a href="{% url 'uzmat:logistics' %}" class="uz-category-card uz-category-card-small">
          <div class="uz-category-icon">
            <img src="{% static 'uzmat/telegram-cloud-document-2-5289604459586945304-removebg-preview.png' %}" alt="–†–µ–º–æ–Ω—Ç">
          </div>
          <span class="uz-category-text">–†–µ–º–æ–Ω—Ç</span>
        </a>

      </div>
    </section>

    <!-- Bento Grid Content -->
    <section class="uz-animate-in" style="animation-delay: 0.1s;">
      <div class="uz-flex" style="justify-content: space-between; margin-bottom: 24px; padding: 0 20px;">
        <h2 style="font-size: 20px; font-weight: 600;">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</h2>
        <a href="{% url 'uzmat:catalog' %}" class="uz-btn uz-btn-ghost" style="font-size: 13px;">–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ &rarr;</a>
      </div>

      <!-- Filters -->
      <form method="get" action="{% url 'uzmat:index' %}" id="filters-form">
        <div class="uz-filters-container">
          <div class="uz-filters-grid">
            <!-- Country Filter -->
            <div class="uz-filter-item">
              <label class="uz-filter-label">–°—Ç—Ä–∞–Ω–∞</label>
              <div class="uz-filter-selector" data-filter-country>
                <button type="button" class="uz-filter-button" data-filter-country-toggle>
                  <span data-filter-country-display>{% if request.GET.country %}{% if request.GET.country == 'kz' %}üá∞üáø –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω{% elif request.GET.country == 'uz' %}üá∫üáø –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω{% elif request.GET.country == 'ru' %}üá∑üá∫ –†–æ—Å—Å–∏—è{% else %}–í—Å–µ —Å—Ç—Ä–∞–Ω—ã{% endif %}{% else %}–í—Å–µ —Å—Ç—Ä–∞–Ω—ã{% endif %}</span>
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"></polyline>
                  </svg>
                </button>
                <div class="uz-filter-dropdown" data-filter-country-dropdown>
                  <button type="button" class="uz-filter-option {% if not request.GET.country or request.GET.country == 'all' %}active{% endif %}" data-filter-value="all" data-filter-name="country">–í—Å–µ —Å—Ç—Ä–∞–Ω—ã</button>
                  <button type="button" class="uz-filter-option {% if request.GET.country == 'kz' %}active{% endif %}" data-filter-value="kz" data-filter-name="country">
                    <span style="font-size: 18px; margin-right: 8px;">üá∞üáø</span>
                    <span>–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω</span>
                  </button>
                  <button type="button" class="uz-filter-option {% if request.GET.country == 'uz' %}active{% endif %}" data-filter-value="uz" data-filter-name="country">
                    <span style="font-size: 18px; margin-right: 8px;">üá∫üáø</span>
                    <span>–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω</span>
                  </button>
                  <button type="button" class="uz-filter-option {% if request.GET.country == 'ru' %}active{% endif %}" data-filter-value="ru" data-filter-name="country">
                    <span style="font-size: 18px; margin-right: 8px;">üá∑üá∫</span>
                    <span>–†–æ—Å—Å–∏—è</span>
                  </button>
                </div>
                <input type="hidden" name="country" value="{{ request.GET.country|default:'' }}">
              </div>
            </div>

            <!-- City Filter -->
            <div class="uz-filter-item">
              <label class="uz-filter-label">–ì–æ—Ä–æ–¥</label>
              <div class="uz-filter-selector" data-filter-city>
                <button type="button" class="uz-filter-button" data-filter-city-toggle>
                  <span data-filter-city-display>{% if request.GET.city and request.GET.city != 'all' %}{{ request.GET.city }}{% else %}–í—Å–µ –≥–æ—Ä–æ–¥–∞{% endif %}</span>
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"></polyline>
                  </svg>
                </button>
                <div class="uz-filter-dropdown" data-filter-city-dropdown>
                  <input type="text" class="uz-filter-search" placeholder="–ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞..." data-filter-city-search>
                  <div class="uz-filter-options-list" data-filter-city-list>
                    <button type="button" class="uz-filter-option {% if not request.GET.city or request.GET.city == 'all' %}active{% endif %}" data-filter-value="all" data-filter-name="city">–í—Å–µ –≥–æ—Ä–æ–¥–∞</button>
                  </div>
                </div>
                <input type="hidden" name="city" value="{{ request.GET.city|default:'' }}">
              </div>
            </div>

          <!-- Type Filter -->
          <div class="uz-filter-item">
            <label class="uz-filter-label">–¢–∏–ø</label>
            <input type="text" class="uz-filter-input" name="equipment_type" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –≠–∫—Å–∫–∞–≤–∞—Ç–æ—Ä" value="{{ request.GET.equipment_type }}">
          </div>

          <!-- Brand Filter -->
          <div class="uz-filter-item">
            <label class="uz-filter-label">–ú–∞—Ä–∫–∞</label>
            <input type="text" class="uz-filter-input" name="brand" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Komatsu" value="{{ request.GET.brand }}">
          </div>

          <!-- Price Filter -->
          <div class="uz-filter-item">
            <div class="uz-filter-label-row">
              <label class="uz-filter-label">–¶–µ–Ω–∞</label>
              <button type="button" class="uz-filter-help" data-price-help-toggle aria-label="–ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ —Ü–µ–Ω–µ">!</button>
              <div class="uz-filter-tooltip" data-price-help-tooltip hidden>–ß—Ç–æ–±—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ —Ü–µ–Ω–µ, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É.</div>
            </div>
            <div class="uz-filter-price-range">
              <input type="number" class="uz-filter-input uz-filter-price-input" name="price_from" placeholder="–û—Ç" value="{{ request.GET.price_from }}"{% if not request.GET.country %} disabled{% endif %}>
              <span>-</span>
              <input type="number" class="uz-filter-input uz-filter-price-input" name="price_to" placeholder="–î–æ" value="{{ request.GET.price_to }}"{% if not request.GET.country %} disabled{% endif %}>
            </div>
          </div>
        </div>
      </form>

      <div class="uz-bento-grid">
        {% for ad in popular_ads %}
        {% if ad.slug %}
        <article class="uz-ad-card">
          <a href="{% url 'uzmat:ad_detail' slug=ad.slug %}" class="uz-ad-card-link">
            <div class="uz-ad-image">
              {% if ad.images.exists %}
                <img src="{{ ad.images.first.image.url }}" alt="{{ ad.title }}" style="width: 100%; height: 100%; object-fit: cover; object-position: center;">
              {% elif ad.image %}
                <img src="{{ ad.image.url }}" alt="{{ ad.title }}" style="width: 100%; height: 100%; object-fit: cover; object-position: center;">
              {% else %}
                <svg class="uz-ad-image-icon" viewBox="0 0 775 775" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M209.896 678.125C290.15 678.125 355.208 613.066 355.208 532.812C355.208 452.559 290.15 387.5 209.896 387.5C129.642 387.5 64.5833 452.559 64.5833 532.812C64.5833 613.066 129.642 678.125 209.896 678.125Z" stroke="currentColor" stroke-width="48.4375" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M613.542 678.125C667.044 678.125 710.417 634.753 710.417 581.25C710.417 527.747 667.044 484.375 613.542 484.375C560.039 484.375 516.667 527.747 516.667 581.25C516.667 634.753 560.039 678.125 613.542 678.125Z" stroke="currentColor" stroke-width="48.4375" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M64.5833 339.059C101.195 311.596 144.839 295.068 190.459 291.392C236.079 287.716 281.807 297.042 322.344 318.288C362.881 339.535 396.568 371.834 419.501 411.441C442.434 451.048 453.675 496.343 451.922 542.077C451.179 561.581 450.824 571.366 455.571 576.306C460.318 581.247 469.133 581.247 486.732 581.247H516.667M419.792 290.622L520.089 309.416C595.652 323.624 633.466 330.696 655.779 357.595C678.125 384.494 678.125 423.147 678.125 500.518M645.833 387.497H613.542" stroke="currentColor" stroke-width="48.4375" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M419.792 403.646V309.58C419.792 296.943 417.973 284.565 414.334 272.445L371.354 96.875M129.167 290.625V96.875M96.875 96.875H419.792M581.25 306.771V258.333C581.25 241.205 588.054 224.778 600.166 212.666C612.278 200.554 628.705 193.75 645.833 193.75M226.042 290.625V96.875" stroke="currentColor" stroke-width="48.4375" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              {% endif %}
            </div>
            <div class="uz-ad-content">
              <div class="uz-ad-content-header">
                <div style="display:flex; flex-direction: column; gap: 2px;">
                  <div class="uz-ad-price">{{ ad.get_price_display }}</div>
                  {% if ad.price_usd %}
                  <div style="font-size: 13px; color: var(--uz-text-dim);">{{ ad.get_price_usd_display }}</div>
                  {% endif %}
                </div>
                {% if user.is_authenticated %}
                <button class="uz-ad-favorite" type="button" aria-label="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ" data-ad-id="{{ ad.id }}" onclick="toggleFavorite(event, {{ ad.id }})">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                  </svg>
                </button>
                {% endif %}
              </div>
              <div>
                <h3 class="uz-ad-title">{{ ad.title }}</h3>
                <div class="uz-ad-subtitle">{{ ad.get_ad_type_display }}{% if ad.with_operator %} ‚Ä¢ –° –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º{% endif %}</div>
                <div class="uz-ad-description">{{ ad.description|truncatewords:12 }}</div>
              </div>
              <div class="uz-ad-meta">
                <div class="uz-ad-meta-left">
                  <svg class="uz-ad-meta-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                  </svg>
                  <span>{{ ad.city }}</span>
                  <span>‚Ä¢</span>
                  <span>{{ ad.created_at|date:"d M" }}</span>
                </div>
                <div class="uz-ad-meta-right">
                  <svg class="uz-ad-meta-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                  <span>{{ ad.views_count }}</span>
                </div>
              </div>
            </div>
          </a>
        </article>
        {% endif %}
        {% empty %}
        <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--uz-text-dim);">
          <p>–ü–æ–∫–∞ –Ω–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–π</p>
        </div>
        {% endfor %}
      </div>

      <!-- –ö–Ω–æ–ø–∫–∞ "–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ" -->
      <div style="display: flex; justify-content: center; margin-top: 40px;">
        <a href="{% url 'uzmat:catalog' %}" class="uz-btn uz-btn-primary">
          –°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ
        </a>
      </div>
    </section>

  </main>

  {% include 'uzmat/footer.html' %}

  <!-- Mobile Navigation -->
  <nav class="uz-bottom-nav uz-show-mobile">
    <a href="{% url 'uzmat:index' %}" class="uz-bottom-item active">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
      <span>–ì–ª–∞–≤–Ω–∞—è</span>
    </a>
    <a href="{% url 'uzmat:chats' %}" class="uz-bottom-item" style="position: relative;">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
      </svg>
      <span>–ß–∞—Ç—ã</span>
      {% if user.is_authenticated and unread_messages_count > 0 %}
      <span class="uz-badge" style="position: absolute; top: 4px; right: 4px; background: var(--uz-danger); color: white; min-width: 16px; height: 16px; padding: 0 4px; font-size: 10px; font-weight: 700; border-radius: 8px; display: flex; align-items: center; justify-content: center;">{{ unread_messages_count }}</span>
      {% endif %}
    </a>
    <a href="{% url 'uzmat:create_ad' %}" class="uz-bottom-item" style="color: var(--uz-primary);">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="16"></line>
        <line x1="8" y1="12" x2="16" y2="12"></line>
      </svg>
      <span>–°–æ–∑–¥–∞—Ç—å</span>
    </a>
    {% if user.is_authenticated %}
    <a href="{% url 'uzmat:profile' %}" class="uz-bottom-item">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
      <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
    </a>
    {% else %}
    <a href="{% url 'uzmat:onboarding' %}" class="uz-bottom-item">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
      <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
    </a>
    {% endif %}
    <a href="{% url 'uzmat:settings' %}" class="uz-bottom-item">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round">
        <circle cx="12" cy="12" r="3"></circle>
        <path
          d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
        </path>
      </svg>
      <span>–ú–µ–Ω—é</span>
    </a>
  </nav>

  <script>
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
    
    // –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
    function toggleFavorite(event, adId) {
      event.preventDefault();
      event.stopPropagation();
      
      {% if not user.is_authenticated %}
      window.location.href = "{% url 'uzmat:auth' %}";
      return;
      {% endif %}
      
      const button = event.currentTarget;
      const url = "{% url 'uzmat:toggle_favorite' ad_id=0 %}".replace('0', adId);
      const csrftoken = getCookie('csrftoken');
      
      fetch(url, {
        method: 'POST',
        headers: {
          'X-CSRFToken': csrftoken,
          'Content-Type': 'application/json',
        },
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(data => {
        if (data.is_favorited !== undefined) {
          if (data.is_favorited) {
            button.style.color = 'var(--uz-primary)';
            if (button.querySelector('path')) {
              button.querySelector('path').setAttribute('fill', 'currentColor');
            }
          } else {
            button.style.color = '';
            if (button.querySelector('path')) {
              button.querySelector('path').removeAttribute('fill');
            }
          }
        }
      })
      .catch(error => {
        console.error('Error:', error);
      });
    }
    
    // –§–∏–ª—å—Ç—Ä—ã - –æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –¥—Ä–æ–ø–¥–∞—É–Ω–æ–≤ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
    document.addEventListener('DOMContentLoaded', function() {
      const filterForm = document.getElementById('filters-form');
      if (!filterForm) return;
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã —á–µ—Ä–µ–∑ AJAX (–¥–µ–ª–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–π –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ country-selector)
      window.submitFormAjax = function submitFormAjax() {
        const formData = new FormData(filterForm);
        const params = new URLSearchParams();
        
        // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–æ—Ä–º—ã
        // –í–ê–ñ–ù–û: country –∏ city –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –í–°–ï–ì–î–ê, –¥–∞–∂–µ –µ—Å–ª–∏ –ø—É—Å—Ç—ã–µ (–¥–ª—è —Å–±—Ä–æ—Å–∞ —Ñ–∏–ª—å—Ç—Ä–∞)
        const countryValue = formData.get('country') || '';
        const cityValue = formData.get('city') || '';
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º country –∏ city –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        if (countryValue && countryValue.trim() !== '') {
          params.append('country', countryValue.trim());
        }
        if (cityValue && cityValue.trim() !== '') {
          params.append('city', cityValue.trim());
        }
        
        // –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –ø—É—Å—Ç—ã–µ
        for (const [key, value] of formData.entries()) {
          if (key !== 'country' && key !== 'city') {
            if (value && value.trim() !== '') {
              params.append(key, value.trim());
            }
          }
        }
        
        // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        let indexUrl = filterForm.action || '/';
        if (indexUrl === '' || indexUrl === '/') {
          indexUrl = '/';
        }
        indexUrl = indexUrl.split('?')[0];
        
        const fullUrl = indexUrl + '?' + params.toString();
        
        // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        console.log('=== –û–¢–õ–ê–î–ö–ê –§–ò–õ–¨–¢–†–û–í (–ì–õ–ê–í–ù–ê–Ø) ===');
        console.log('–ü–∞—Ä–∞–º–µ—Ç—Ä country:', countryValue);
        console.log('–ü–∞—Ä–∞–º–µ—Ç—Ä city:', cityValue);
        console.log('–ü–æ–ª–Ω—ã–π URL –∑–∞–ø—Ä–æ—Å–∞:', fullUrl);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Å–∫—Ä–æ–ª–ª–∞
        const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        const adsContainer = document.querySelector('.uz-bento-grid');
        if (adsContainer) {
          adsContainer.style.opacity = '0.5';
        }
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å
        fetch(fullUrl, {
          method: 'GET',
          headers: {
            'X-Requested-With': 'XMLHttpRequest',
          }
        })
        .then(response => response.text())
        .then(html => {
          // –£–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
          if (adsContainer) {
            adsContainer.style.opacity = '1';
          }
          
          // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          
          // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
          if (adsContainer) {
            const newAdsContainer = doc.querySelector('.uz-bento-grid');
            if (newAdsContainer) {
              adsContainer.innerHTML = newAdsContainer.innerHTML;
            }
          }
          
          // –û–±–Ω–æ–≤–ª—è–µ–º URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
          window.history.pushState({}, '', fullUrl);
          
          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é —Å–∫—Ä–æ–ª–ª–∞
          window.scrollTo(0, scrollPosition);
        })
        .catch(error => {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
          if (adsContainer) {
            adsContainer.style.opacity = '1';
          }
        });
      }
      
      // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –¥—Ä–æ–ø–¥–∞—É–Ω–∞ —Å—Ç—Ä–∞–Ω—ã
      const countryToggle = filterForm.querySelector('[data-filter-country-toggle]');
      const countryDropdown = filterForm.querySelector('[data-filter-country-dropdown]');
      const countrySelector = filterForm.querySelector('[data-filter-country]');
      
      if (countryToggle && countryDropdown && countrySelector) {
        countryToggle.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          // –ó–∞–∫—Ä—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ –¥—Ä–æ–ø–¥–∞—É–Ω—ã
          const citySelector = filterForm.querySelector('[data-filter-city]');
          if (citySelector) {
            citySelector.removeAttribute('data-open');
          }
          
          // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –¥—Ä–æ–ø–¥–∞—É–Ω
          if (countrySelector.hasAttribute('data-open')) {
            countrySelector.removeAttribute('data-open');
          } else {
            countrySelector.setAttribute('data-open', '');
          }
        });
      }
      
      // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –¥—Ä–æ–ø–¥–∞—É–Ω–∞ –≥–æ—Ä–æ–¥–∞
      const cityToggle = filterForm.querySelector('[data-filter-city-toggle]');
      const cityDropdown = filterForm.querySelector('[data-filter-city-dropdown]');
      const citySelector = filterForm.querySelector('[data-filter-city]');
      const citySearchInput = filterForm.querySelector('[data-filter-city-search]');
      
      if (cityToggle && cityDropdown && citySelector) {
        cityToggle.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          // –ó–∞–∫—Ä—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ –¥—Ä–æ–ø–¥–∞—É–Ω—ã
          if (countrySelector) {
            countrySelector.removeAttribute('data-open');
          }
          
          // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –¥—Ä–æ–ø–¥–∞—É–Ω
          if (citySelector.hasAttribute('data-open')) {
            citySelector.removeAttribute('data-open');
          } else {
            citySelector.setAttribute('data-open', '');
            // –§–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
            if (citySearchInput) {
              setTimeout(() => citySearchInput.focus(), 100);
            }
          }
        });
      }
      
      // –ü–æ–∏—Å–∫ –≤ —Ñ–∏–ª—å—Ç—Ä–µ –≥–æ—Ä–æ–¥–æ–≤
      if (citySearchInput && citySelector) {
        citySearchInput.addEventListener('input', function(e) {
          const query = e.target.value.toLowerCase().trim();
          const cityOptions = citySelector.querySelectorAll('[data-filter-name="city"]');
          
          cityOptions.forEach(option => {
            const cityName = option.textContent.toLowerCase();
            if (cityName.includes(query)) {
              option.style.display = '';
            } else {
              option.style.display = 'none';
            }
          });
        });
      }
      
      // –ó–∞–∫—Ä—ã—Ç–∏–µ –¥—Ä–æ–ø–¥–∞—É–Ω–æ–≤ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
      document.addEventListener('click', function(e) {
        if (!e.target.closest('[data-filter-country]') && !e.target.closest('[data-filter-city]')) {
          if (countrySelector) countrySelector.removeAttribute('data-open');
          if (citySelector) citySelector.removeAttribute('data-open');
        }
      });
      
      // –°–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º
      const citiesByCountry = {
        kz: [
          "–ê–ª–º–∞—Ç—ã", "–ê—Å—Ç–∞–Ω–∞", "–®—ã–º–∫–µ–Ω—Ç", "–ö–∞—Ä–∞–≥–∞–Ω–¥–∞", "–ê–∫—Ç–æ–±–µ", "–¢–∞—Ä–∞–∑", "–ü–∞–≤–ª–æ–¥–∞—Ä",
          "–£—Å—Ç—å-–ö–∞–º–µ–Ω–æ–≥–æ—Ä—Å–∫", "–°–µ–º–µ–π", "–ö–æ—Å—Ç–∞–Ω–∞–π", "–ö—ã–∑—ã–ª–æ—Ä–¥–∞", "–£—Ä–∞–ª—å—Å–∫", "–ü–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫",
          "–ê—Ç—ã—Ä–∞—É", "–¢—É—Ä–∫–µ—Å—Ç–∞–Ω", "–ö–æ–∫—à–µ—Ç–∞—É", "–¢–µ–º–∏—Ä—Ç–∞—É", "–≠–∫–∏–±–∞—Å—Ç—É–∑", "–†—É–¥–Ω—ã–π", "–ñ–∞–Ω–∞–æ–∑–µ–Ω"
        ],
        uz: [
          "–¢–∞—à–∫–µ–Ω—Ç", "–°–∞–º–∞—Ä–∫–∞–Ω–¥", "–ù–∞–º–∞–Ω–≥–∞–Ω", "–ê–Ω–¥–∏–∂–∞–Ω", "–ù—É–∫—É—Å", "–ë—É—Ö–∞—Ä–∞", "–ö–∞—Ä—à–∏",
          "–§–µ—Ä–≥–∞–Ω–∞", "–ö–æ–∫–∞–Ω–¥", "–ú–∞—Ä–≥–∏–ª–∞–Ω", "–î–∂–∏–∑–∞–∫", "–ì—É–ª–∏—Å—Ç–∞–Ω", "–¢–µ—Ä–º–µ–∑", "–£—Ä–≥–µ–Ω—á",
          "–ù–∞–≤–æ–∏", "–ê–Ω–≥—Ä–µ–Ω", "–ß–∏—Ä—á–∏–∫", "–ë–µ–∫–∞–±–∞–¥", "–î–µ–Ω–∞—É", "–®–∞—Ö—Ä–∏—Å–∞–±–∑"
        ],
        ru: [
          "–ú–æ—Å–∫–≤–∞", "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥", "–ö–∞–∑–∞–Ω—å", "–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥",
          "–ß–µ–ª—è–±–∏–Ω—Å–∫", "–°–∞–º–∞—Ä–∞", "–û–º—Å–∫", "–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É", "–£—Ñ–∞", "–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫", "–í–æ—Ä–æ–Ω–µ–∂",
          "–ü–µ—Ä–º—å", "–í–æ–ª–≥–æ–≥—Ä–∞–¥", "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", "–°–∞—Ä–∞—Ç–æ–≤", "–¢—é–º–µ–Ω—å", "–¢–æ–ª—å—è—Ç—Ç–∏", "–ò–∂–µ–≤—Å–∫"
        ]
      };

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≥–æ—Ä–æ–¥–æ–≤ (–¥–µ–ª–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–π –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏–∑ country-selector)
      window.updateCityList = function updateCityList(country) {
        const cityList = citySelector.querySelector('[data-filter-city-list]');
        if (!cityList) return;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–Ω–æ–ø–∫—É "–í—Å–µ –≥–æ—Ä–æ–¥–∞"
        const allCitiesBtn = cityList.querySelector('[data-filter-value="all"]');
        const allCitiesHtml = allCitiesBtn ? allCitiesBtn.outerHTML : '<button type="button" class="uz-filter-option" data-filter-value="all" data-filter-name="city">–í—Å–µ –≥–æ—Ä–æ–¥–∞</button>';
        
        // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫
        cityList.innerHTML = allCitiesHtml;
        
        // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∞, –¥–æ–±–∞–≤–ª—è–µ–º –≥–æ—Ä–æ–¥–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω—ã
        if (country && country !== 'all' && citiesByCountry[country]) {
          const cities = citiesByCountry[country];
          cities.forEach(city => {
            const button = document.createElement('button');
            button.type = 'button';
            button.className = 'uz-filter-option';
            button.setAttribute('data-filter-value', city);
            button.setAttribute('data-filter-name', 'city');
            button.textContent = city;
            
            cityList.appendChild(button);
          });
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –≥–æ—Ä–æ–¥–æ–≤ (–≤–∫–ª—é—á–∞—è "–í—Å–µ –≥–æ—Ä–æ–¥–∞")
        cityList.querySelectorAll('[data-filter-name="city"]').forEach(btn => {
          btn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            const value = this.getAttribute('data-filter-value');
            const hiddenInput = filterForm.querySelector('input[name="city"]');
            if (hiddenInput) {
              hiddenInput.value = value === 'all' ? '' : value;
              // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç
              const display = citySelector.querySelector('[data-filter-city-display]');
              if (display) {
                display.textContent = this.textContent.trim();
              }
              // –ó–∞–∫—Ä—ã–≤–∞–µ–º –¥—Ä–æ–ø–¥–∞—É–Ω
              citySelector.removeAttribute('data-open');
              // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É —á–µ—Ä–µ–∑ AJAX
              submitFormAjax();
            }
          });
        });
      }
      
      // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã
      filterForm.addEventListener('submit', function(e) {
        e.preventDefault();
        submitFormAjax();
        return false;
      });
      
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞–Ω—ã
      filterForm.querySelectorAll('[data-filter-name="country"]').forEach(option => {
        option.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          const value = this.getAttribute('data-filter-value');
          const hiddenInput = filterForm.querySelector('input[name="country"]');
          if (hiddenInput) {
            const countryValue = value === 'all' ? '' : value;
            hiddenInput.value = countryValue;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç
            const display = countrySelector.querySelector('[data-filter-country-display]');
            if (display) {
              display.textContent = this.textContent.trim();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            filterForm.querySelectorAll('[data-filter-name="country"]').forEach(opt => opt.classList.remove('active'));
            this.classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤
            updateCityList(value);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è —Ü–µ–Ω—ã (–≤–∫–ª—é—á–∞–µ–º/–≤—ã–∫–ª—é—á–∞–µ–º)
            const priceInputs = filterForm.querySelectorAll('input[name="price_from"], input[name="price_to"]');
            if (priceInputs.length > 0) {
              const hasCountry = value && value !== 'all' && value !== '';
              priceInputs.forEach(input => {
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–º–∞–µ–º –∞—Ç—Ä–∏–±—É—Ç disabled
                input.removeAttribute('disabled');
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º disabled —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞
                if (!hasCountry) {
                  input.setAttribute('disabled', 'disabled');
                  input.value = '';
                } else {
                  // –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∞ –≤—ã–±—Ä–∞–Ω–∞, —É–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ disabled —Å–Ω—è—Ç
                  input.removeAttribute('disabled');
                }
              });
            }
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –¥—Ä–æ–ø–¥–∞—É–Ω —Å—Ç—Ä–∞–Ω—ã
            countrySelector.removeAttribute('data-open');
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É —á–µ—Ä–µ–∑ AJAX –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π
            submitFormAjax();
          }
        });
      });
      
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –≥–æ—Ä–æ–¥–∞ (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
      if (citySelector) {
        const cityList = citySelector.querySelector('[data-filter-city-list]');
        if (cityList) {
          cityList.addEventListener('click', function(e) {
            const option = e.target.closest('[data-filter-name="city"]');
            if (!option) return;
            
            e.preventDefault();
            e.stopPropagation();
            const value = option.getAttribute('data-filter-value');
            const hiddenInput = filterForm.querySelector('input[name="city"]');
            if (hiddenInput) {
              hiddenInput.value = value === 'all' ? '' : value;
              // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–π —Ç–µ–∫—Å—Ç
              const display = citySelector.querySelector('[data-filter-city-display]');
              if (display) {
                display.textContent = option.textContent.trim();
              }
              // –ó–∞–∫—Ä—ã–≤–∞–µ–º –¥—Ä–æ–ø–¥–∞—É–Ω
              citySelector.removeAttribute('data-open');
              // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É —á–µ—Ä–µ–∑ AJAX
              submitFormAjax();
            }
          });
        }
      }
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –≥–æ—Ä–æ–¥–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      const currentCountry = filterForm.querySelector('input[name="country"]')?.value || '';
      if (currentCountry) {
        updateCityList(currentCountry);
      }
      
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π - –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
      filterForm.querySelectorAll('input[name="equipment_type"], input[name="brand"], input[name="price_from"], input[name="price_to"]').forEach(input => {
        input.addEventListener('change', function() {
          submitFormAjax();
        });
      });
    });

    // –ü–æ–∏—Å–∫ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    const heroSearchInput = document.getElementById('hero-search-input');
    if (heroSearchInput) {
      let searchTimeout;
      let viewportMeta = document.querySelector('meta[name="viewport"]');
      let originalViewport = viewportMeta ? viewportMeta.getAttribute('content') : 'width=device-width, initial-scale=1.0';
      let isZoomed = false;

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∞
      function zoomIn() {
        if (!isZoomed && viewportMeta) {
          viewportMeta.setAttribute('content', 'width=device-width, initial-scale=1.5, maximum-scale=1.5, user-scalable=no');
          isZoomed = true;
        }
      }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –º–∞—Å—à—Ç–∞–±–∞
      function zoomOut() {
        if (isZoomed && viewportMeta) {
          viewportMeta.setAttribute('content', originalViewport);
          isZoomed = false;
        }
      }

      // –ü—Ä–∏ —Ñ–æ–∫—É—Å–µ - —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –º–∞—Å—à—Ç–∞–±
      heroSearchInput.addEventListener('focus', zoomIn);
      
      // –ü—Ä–∏ –Ω–∞—á–∞–ª–µ –≤–≤–æ–¥–∞ - —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –º–∞—Å—à—Ç–∞–± (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ —Ñ–æ–∫—É—Å —É–∂–µ –±—ã–ª)
      heroSearchInput.addEventListener('input', function(e) {
        const query = e.target.value.trim();
        
        if (!isZoomed) {
          zoomIn();
        }
        
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–∏ –≤–≤–æ–¥–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π –±—É–∫–≤—ã
          if (query.length >= 1) {
            zoomOut(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–± –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º
            window.location.href = "{% url 'uzmat:catalog' %}?search=" + encodeURIComponent(query);
          }
        }, 200); // –£–º–µ–Ω—å—à–µ–Ω–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
      });

      heroSearchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          const query = e.target.value.trim();
          if (query.length >= 1) {
            zoomOut(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–± –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º
            window.location.href = "{% url 'uzmat:catalog' %}?search=" + encodeURIComponent(query);
          }
        }
      });

      // –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞ –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–±
      heroSearchInput.addEventListener('blur', function() {
        setTimeout(() => {
          if (isZoomed && !heroSearchInput.value.trim()) {
            zoomOut();
          }
        }, 200);
      });
    }

    // –ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏ –ø–æ–∏—Å–∫–∞
    document.querySelectorAll('.uz-search-quick-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const query = this.getAttribute('data-search-query');
        if (query && heroSearchInput) {
          heroSearchInput.value = query;
          window.location.href = "{% url 'uzmat:catalog' %}?search=" + encodeURIComponent(query);
        }
      });
    });
  </script>

  <!-- Django Messages to Toast -->
  {% if messages %}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      {% for message in messages %}
        {% if 'auth' in message.extra_tags %}
          {% if message.tags == 'error' %}
            window.showToast('{{ message|escapejs }}', 'error');
          {% elif message.tags == 'success' %}
            window.showToast('{{ message|escapejs }}', 'success');
          {% elif message.tags == 'warning' %}
            window.showToast('{{ message|escapejs }}', 'warning');
          {% else %}
            window.showToast('{{ message|escapejs }}', 'info');
          {% endif %}
        {% endif %}
      {% endfor %}
    });
  </script>
  {% endif %}

</body>

</html>